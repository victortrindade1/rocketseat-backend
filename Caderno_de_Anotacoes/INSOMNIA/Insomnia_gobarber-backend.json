{"_type":"export","__export_format":4,"__export_date":"2019-12-06T14:32:07.096Z","__export_source":"insomnia.desktop.app:v7.0.0","resources":[{"_id":"req_327fc1221fc94a47a41202545612372f","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{},"created":1575483112571,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1575483112571,"method":"GET","modified":1575483816044,"name":"List","parameters":[{"id":"pair_ab760d6e467a47e4b28f370461a33f37","name":"date","value":"1575483653556"}],"parentId":"fld_806575655b3b4a2f9c49fcc3f57f1d80","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/providers/33/available","_type":"request"},{"_id":"fld_806575655b3b4a2f9c49fcc3f57f1d80","created":1575483103000,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1575483103000,"modified":1575483103000,"name":"Available","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"wrk_70271076343f4af0b81199cbd9b6b2c3","created":1570036763792,"description":"","modified":1570036763792,"name":"Insomnia","parentId":null,"_type":"workspace"},{"_id":"req_5574a3835592408c8f66f395a45f8db0","authentication":{"token":"{{ token_provider  }}","type":"bearer"},"body":{},"created":1573925837117,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573895075789,"method":"PUT","modified":1574772091354,"name":"Update","parameters":[],"parentId":"fld_cb5f051054d544f8b251bbfba507b4ac","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/notifications/5dcfc2d2e273bc27cff15551","_type":"request"},{"_id":"fld_cb5f051054d544f8b251bbfba507b4ac","created":1573895067228,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1573895067230,"modified":1573895067228,"name":"Notifications","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_9adf5b9367c24af3b1fd5cd38318d2ff","authentication":{"token":"{{ token_provider  }}","type":"bearer"},"body":{},"created":1573895075738,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573895075739,"method":"GET","modified":1574772071259,"name":"List","parameters":[],"parentId":"fld_cb5f051054d544f8b251bbfba507b4ac","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/notifications","_type":"request"},{"_id":"req_3631c29794c64f9b9426baf48f27e4d7","authentication":{"token":"{{ token_provider  }}","type":"bearer"},"body":{},"created":1573827062307,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573827062307,"method":"GET","modified":1574772047612,"name":"List","parameters":[{"id":"pair_adfc8bff454f479cbe7d254c81e08c98","name":"date","value":"2020-11-16T00:00:00-03:00"}],"parentId":"fld_4f3415602ff847e0a61d58dacfed804f","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/schedule","_type":"request"},{"_id":"fld_4f3415602ff847e0a61d58dacfed804f","created":1573827055012,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1573827055012,"modified":1573827055012,"name":"Schedules","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_1675616998ad43e4a87ad5613a1e5f6c","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{},"created":1574766013372,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573770258116,"method":"DELETE","modified":1575471632798,"name":"Delete","parameters":[],"parentId":"fld_a86a5ea7a4dc41739c913bb9ac2e9153","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/appointments/50","_type":"request"},{"_id":"fld_a86a5ea7a4dc41739c913bb9ac2e9153","created":1573770240955,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1573770240955,"modified":1573770240955,"name":"Appointments","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_68dde1e0121d4dd1ae5c9a14c84dafcb","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{},"created":1573822424778,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573770258066,"method":"GET","modified":1574772007991,"name":"Index","parameters":[{"id":"pair_adc8e922bc104bfcb65148fc54e15bb6","name":"page","value":"1"}],"parentId":"fld_a86a5ea7a4dc41739c913bb9ac2e9153","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/appointments","_type":"request"},{"_id":"req_f39341a8dc64407085ae25b648b8dc0d","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{"mimeType":"application/json","text":"{\n\t\"provider_id\": 33,\n\t\"date\": \"2019-12-04T17:00:00-03:00\"\n}"},"created":1573770258016,"description":"","headers":[{"id":"pair_421341702c1046d5b9e4aff7f72bb796","name":"Content-Type","value":"application/json"}],"isPrivate":false,"metaSortKey":-1573770258016,"method":"POST","modified":1575484799856,"name":"Create","parameters":[],"parentId":"fld_a86a5ea7a4dc41739c913bb9ac2e9153","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/appointments","_type":"request"},{"_id":"req_420d2c8dce1149949223bb4875211b78","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{},"created":1573739283732,"description":"","headers":[],"isPrivate":false,"metaSortKey":-1573739283732,"method":"GET","modified":1574771930329,"name":"Index","parameters":[],"parentId":"fld_2aa1e536cb844e00a03399ca2b65bf73","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/providers","_type":"request"},{"_id":"fld_2aa1e536cb844e00a03399ca2b65bf73","created":1573739270950,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1573739270951,"modified":1573739270950,"name":"Providers","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_4cdc6d213f7d4cf2900863b9e9da2dec","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{"mimeType":"multipart/form-data","params":[{"fileName":"/home/victor/Downloads/40868932.jpeg","id":"pair_c97507e6116f427fb6a689dcd25f0c84","name":"file","type":"file","value":""}]},"created":1573344754179,"description":"","headers":[{"id":"pair_051e742582f1458ab3fc9fea7e023d4f","name":"Content-Type","value":"multipart/form-data"}],"isPrivate":false,"metaSortKey":-1573344754179,"method":"POST","modified":1574771888501,"name":"Upload","parameters":[],"parentId":"fld_1eee63f8d5134872864e193c332b449b","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/files","_type":"request"},{"_id":"fld_1eee63f8d5134872864e193c332b449b","created":1573344727580,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1573344727581,"modified":1573344727580,"name":"Files","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_8cbfedad179e4a44b2cdd4260ad2243c","authentication":{},"body":{"mimeType":"application/json","text":"{\n\t\"email\": \"victortrindade@gmail.com\",\n\t\"password\": \"123456\"\n}"},"created":1572374575367,"description":"# Gerar Hash\n\nA partir da senha digitada pelo usuário no form, vamos gerar um hash, e salvar\napenas o hash e não a senha. Para gerar hash, use o `bcryptjs`.\n\n`yarn add bcryptjs`\n\n## No model...\n\nAntes:\n\n```\nimport Sequelize, { Model } from 'sequelize';\n\nclass User extends Model {\n  static init(sequelize) {\n    super.init(\n      {\n        name: Sequelize.STRING,\n        email: Sequelize.STRING,\n        password_hash: Sequelize.STRING,\n        provider: Sequelize.BOOLEAN,\n      },\n      {\n        sequelize,\n      }\n    );\n  }\n}\n\nexport default User;\n```\n\nDepois:\n\n```\nimport Sequelize, { Model } from 'sequelize';\nimport bcrypt from 'bcryptjs';\n\nclass User extends Model {\n  static init(sequelize) {\n    super.init(\n      {\n        name: Sequelize.STRING,\n        email: Sequelize.STRING,\n        password: Sequelize.VIRTUAL,\n        password_hash: Sequelize.STRING,\n        provider: Sequelize.BOOLEAN,\n      },\n      {\n        sequelize,\n      }\n    );\n\n    this.addHook('beforeSave', async user => {\n      if (user.password) {\n        const userEncrypted = user;\n        userEncrypted.password_hash = await bcrypt.hash(user.password, 8);\n      }\n    });\n\n    return this;\n  }\n\n  checkPassword(password) {\n    return bcrypt.compare(password, this.password_hash);\n  }\n}\n\nexport default User;\n```\n\n# JWT (JSON Web Token)\n\n`yarn add jsonwebtoken`\n\nO JWT é uma forma de fazer autenticação para serviços RESTful. Vc manipula o\ntoken em formato JSON.\n\nCom o JWT, o usuário logado possui uma chave de acesso, um token mesmo. O token\nnos prova que realmente é um usuário desse sistema.\n\nO token não pode conter a senha do usuário, pois é fácil desvendar informações\nnum token. Não é para isso q ele serve, não é para criptografar. É para provar q\nele veio daqui de dentro, com uma chave única vinculada a este sistema.\n\nO JWT é dividido em 3 partes separadas por um ponto `.`:\n\n![jwt-image](/Caderno_de_Anotacoes/6-Gerar-hash_JWT/images/img1.png)\n\n- Headers\n  - Mostram o tipo de token. O JWT possui muitos tipos, e aqui mostra o seu.\n  - É importante ter noção de onde é o header, pois usaremos isto no front-end.\n- Payloads\n  - São suas informações dentro do token, como id, e-mail, nome, etc.\n    > **Nunca coloque senha ou outras informações sensíveis no token**\n- Assinatura\n  - Por mais que tentem alterar informações do payload, existe a assinatura, que\n    garante que minhas informações não serão violadas.\n\nNeste projeto, o JWT foi usado nas Sessions, q são seções do usuário logado.\nAs informações do usuário vêm acompanhadas do token:\n\n## src/app/controllers/SessionController.js\n\nCriando um novo jwt `jwt.sign` na criação de uma nova sessão:\n\n```\nimport jwt from 'jsonwebtoken';\nimport authConfig from '../../config/auth';\nimport User from '../models/User';\n\nclass SessionController {\n  // Método store -> cria nova session]\n  // Repare q store não necessariamente significa gravar algo no banco\n  async store(req, res) {\n    const { email, password } = req.body;\n\n    const user = await User.findOne({ where: { email } });\n\n    if (!user) {\n      return res.status(401).json({ error: 'User not found' });\n    }\n\n    if (!(await user.checkPassword(password))) {\n      return res.status(401).json({ error: 'Password does not match' });\n    }\n\n    const { id, name } = user;\n\n    return res.json({\n      user: {\n        id,\n        name,\n        email,\n      },\n      token: jwt.sign({ id }, authConfig.secret, {\n        expiresIn: authConfig.expiresIn,\n      }),\n    });\n  }\n}\n\nexport default new SessionController();\n```\n\nPra organizar, foi criado um arquivo para guardar informações sensíveis `auth.js`\n\n### src/config/auth.js\n\nÉ vc q escolhe a chave de segurança q prova q o token do jwt vem realmente do\nseu sistema. Essa chave foi colocada num arquivo separado para organizar. Junto,\no prazo para expirar a sessão do usuário.\n\n```\nexport default {\n  secret: 'eb8f7b80ca95741e6d69c8905a64fa7e',\n  expiresIn: '7d',\n};\n```\n\n> Uma dica: tá com preguiça de escolher senha? [me acesse](https://www.md5online.org)\n\n## Middlewares para JWT\n\nAgora que\n","headers":[{"id":"pair_02f798fb4bc94f54b01e6359cfad23eb","name":"Content-Type","value":"application/json"}],"isPrivate":false,"metaSortKey":-1572046038485,"method":"POST","modified":1575465237422,"name":"Create","parameters":[],"parentId":"fld_7da0683bcf1d476695274832cd9fc720","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/sessions","_type":"request"},{"_id":"fld_7da0683bcf1d476695274832cd9fc720","created":1572374383819,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1572374383819,"modified":1572374383819,"name":"Sessions","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_e7b3ebf6a0cd43728a16fc601164d740","authentication":{"token":"{{ token_comum  }}","type":"bearer"},"body":{"mimeType":"application/json","text":"{\n\t\"name\": \"victor\",\n\t\"email\": \"user@gmail.com\",\n\t\"oldPassword\": \"12345678\",\n\t\"password\": \"123456\",\n\t\"confirmPassword\": \"123456\"\n}"},"created":1572386780710,"description":"","headers":[{"id":"pair_f3aa81f6a05a415a9aad99c0d8331943","name":"Content-Type","value":"application/json"}],"isPrivate":false,"metaSortKey":-1572386780710,"method":"PUT","modified":1574771855362,"name":"Update","parameters":[],"parentId":"fld_6bd810a5ce784c95a8402379b5d62287","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/users","_type":"request"},{"_id":"fld_6bd810a5ce784c95a8402379b5d62287","created":1572045983518,"description":"","environment":{},"environmentPropertyOrder":null,"metaSortKey":-1572045983518,"modified":1572046012935,"name":"Users","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"request_group"},{"_id":"req_4ffb36b29fc24794b7bfb213a10ea657","authentication":{"type":"bearer"},"body":{"mimeType":"application/json","text":"{\n\t\"name\": \"usuario comum\",\n\t\"email\": \"user@gmail.com\",\n\t\"password\": \"123456\",\n\t\"provider\": false\n}"},"created":1572046038535,"description":"","headers":[{"id":"pair_02f798fb4bc94f54b01e6359cfad23eb","name":"Content-Type","value":"application/json"},{"id":"pair_6b6661e39e8742d59b73f1fee7897419","name":"","value":""}],"isPrivate":false,"metaSortKey":-1572046038535,"method":"POST","modified":1573896826350,"name":"Create","parameters":[],"parentId":"fld_6bd810a5ce784c95a8402379b5d62287","settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingSendCookies":true,"settingStoreCookies":true,"url":"{{ base_url  }}/users","_type":"request"},{"_id":"env_75a53b375a9cfc2d7b47ec9ceabc9c2d151636fb","color":null,"created":1570036763925,"data":{"base_url":"http://localhost:3333","port_3001":"http://localhost:3001"},"dataPropertyOrder":{"&":["base_url","port_3001"]},"isPrivate":false,"metaSortKey":1570036763926,"modified":1571265548671,"name":"Base Environment","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"environment"},{"_id":"jar_75a53b375a9cfc2d7b47ec9ceabc9c2d151636fb","cookies":[],"created":1570036763932,"modified":1570036763932,"name":"Default Jar","parentId":"wrk_70271076343f4af0b81199cbd9b6b2c3","_type":"cookie_jar"},{"_id":"env_8473739be91a47bb97d185183cb62275","color":"#4b32ad","created":1572045912837,"data":{"base_url":"http://localhost:3333","token_comum":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MzQsImlhdCI6MTU3NTQ2NTIwOCwiZXhwIjoxNTc2MDcwMDA4fQ.e6twLlhugrAUBk3JunKWrySzuMI48JJeH_AKK3QKO5M","token_provider":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MzMsImlhdCI6MTU3NTQ2NTIzOSwiZXhwIjoxNTc2MDcwMDM5fQ.7ZvwoQL324BMCVUXORu1H3Y8193TO8LACQDJ3E81oKI"},"dataPropertyOrder":{"&":["base_url","token_comum","token_provider"]},"isPrivate":false,"metaSortKey":1572045912837,"modified":1575465264578,"name":"Backend Gobarber","parentId":"env_75a53b375a9cfc2d7b47ec9ceabc9c2d151636fb","_type":"environment"}]}